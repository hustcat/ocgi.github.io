<!doctype html><html lang=en-us><head><meta charset=utf-8><title>Squad介绍</title><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=generator content="Hugo 0.83.1"><link rel=stylesheet href=https://ocgi.github.io/plugins/bootstrap/bootstrap.min.css><link rel=stylesheet href=https://ocgi.github.io/plugins/themify-icons/themify-icons.css><link rel=icon href=https://ocgi.github.io/images/favicon.png type=image/x-icon><link href="https://fonts.googleapis.com/css?family=Lato:300,400,700&display=swap" rel=stylesheet><style>:root{--primary-color:#0052d9;--body-color:#f9f9f9;--text-color:#636363;--text-color-dark:#242738;--white-color:#ffffff;--light-color:#f8f9fa;--font-family:Lato}</style><link href=https://ocgi.github.io/css/style.min.css rel=stylesheet media=screen><script src=https://ocgi.github.io/plugins/jquery/jquery-1.12.4.js></script><script src=https://ocgi.github.io/plugins/jquery/jquery-ui.js></script><script src=https://ocgi.github.io/plugins/bootstrap/bootstrap.min.js></script><script src=https://ocgi.github.io/plugins/match-height/jquery.matchHeight-min.js></script></head><body><header class="shadow-bottom sticky-top bg-white"><nav class="navbar navbar-expand-md navbar-light"><div class=container><a class="navbar-brand px-2" href=/>OCGI</a>
<button class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation aria-controls=navigation aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse text-center" id=navigation><ul class="navbar-nav ml-auto"><li class=nav-item><a class="nav-link text-dark" href=https://ocgi.github.io/en/docs/>Docs</a></li><li class=nav-item><a class="nav-link text-dark" href=https://github.com/ocgi>Github</a></li></ul><select class="lang-list dark" id=select-language onchange="location=this.value"><option id=en value=https://ocgi.github.io/zh/docs/guides/squad_details/ selected>En</option></select></div></div></nav></header><section class="single section-sm pb-0"><div class=container><div class=row><div class=col-lg-3><div class=sidebar><ul class=list-styled><a class=back-btn href=/></a><li data-nav-id=https://ocgi.github.io/zh/ title=Zhs class=sidelist><a href=https://ocgi.github.io/zh/>Zhs</a><ul><li data-nav-id=https://ocgi.github.io/zh/docs/ title="OCGI Documentation" class=sidelist><a href=https://ocgi.github.io/zh/docs/>OCGI Documentation</a><ul><li data-nav-id=https://ocgi.github.io/zh/docs/overview/ title=Overview class=sidelist><a href=https://ocgi.github.io/zh/docs/overview/>Overview</a></li><li data-nav-id=https://ocgi.github.io/zh/docs/installation/ title=Installation class=sidelist><a href=https://ocgi.github.io/zh/docs/installation/>Installation</a></li><li data-nav-id=https://ocgi.github.io/zh/docs/getting-started/ title="Getting Started" class=sidelist><a href=https://ocgi.github.io/zh/docs/getting-started/>Getting Started</a><ul><li data-nav-id=https://ocgi.github.io/zh/docs/getting-started/gameserver/ title=创建GameServer class=sidelist><a href=https://ocgi.github.io/zh/docs/getting-started/gameserver/>创建GameServer</a></li><li data-nav-id=https://ocgi.github.io/zh/docs/getting-started/squad/ title=创建Squad class=sidelist><a href=https://ocgi.github.io/zh/docs/getting-started/squad/>创建Squad</a></li><li data-nav-id=https://ocgi.github.io/zh/docs/getting-started/gpa/ title="Create a GeneralPodAutoscaler" class=sidelist><a href=https://ocgi.github.io/zh/docs/getting-started/gpa/>Create a GeneralPodAutoscaler</a></li></ul></li><li data-nav-id=https://ocgi.github.io/zh/docs/guides/ title=Guides class=sidelist><a href=https://ocgi.github.io/zh/docs/guides/>Guides</a><ul><li data-nav-id=https://ocgi.github.io/zh/docs/guides/squad_details/ title=Squad介绍 class="sidelist
active"><a href=https://ocgi.github.io/zh/docs/guides/squad_details/>Squad介绍</a></li><li data-nav-id=https://ocgi.github.io/zh/docs/guides/gpa/ title=GeneralPodAutoscaler介绍 class=sidelist><a href=https://ocgi.github.io/zh/docs/guides/gpa/>GeneralPodAutoscaler介绍</a></li><li data-nav-id=https://ocgi.github.io/zh/docs/guides/autoscaling_flow/ title=GameServer自动伸缩流程 class=sidelist><a href=https://ocgi.github.io/zh/docs/guides/autoscaling_flow/>GameServer自动伸缩流程</a></li><li data-nav-id=https://ocgi.github.io/zh/docs/guides/squad-scaledown-priority/ title=设置GamerServer缩容的优先级 class=sidelist><a href=https://ocgi.github.io/zh/docs/guides/squad-scaledown-priority/>设置GamerServer缩容的优先级</a></li></ul></li><li data-nav-id=https://ocgi.github.io/zh/docs/reference/ title=Reference class=sidelist><a href=https://ocgi.github.io/zh/docs/reference/>Reference</a><ul><li data-nav-id=https://ocgi.github.io/zh/docs/reference/sdk/ title="Carrier SDK" class=sidelist><a href=https://ocgi.github.io/zh/docs/reference/sdk/>Carrier SDK</a></li><li data-nav-id=https://ocgi.github.io/zh/docs/reference/gpa_webhook/ title="GPA Webhook示例" class=sidelist><a href=https://ocgi.github.io/zh/docs/reference/gpa_webhook/>GPA Webhook示例</a></li></ul></li><li data-nav-id=https://ocgi.github.io/zh/docs/examples/ title=Examples class=sidelist><a href=https://ocgi.github.io/zh/docs/examples/>Examples</a></li><li data-nav-id=https://ocgi.github.io/zh/docs/faq/ title="Frequently Asked Questions" class=sidelist><a href=https://ocgi.github.io/zh/docs/faq/>Frequently Asked Questions</a></li></ul></li></ul></li></ul></div></div><div class=col-lg-9><div class="p-lg-5 p-4 bg-white"><h1 class=mb-5>Squad介绍</h1><div class=content><h2 id=squad>Squad</h2><p>一个Squad控制器为GameServers和GameServerSets提供声明式的更新管理能力。用户可以通过描述Squad中的目标状态(例如副本数)，Squad控制器会按照一定的规则更改实际状态，最终使其达到期望的状态。</p><h3 id=主要特点>主要特点</h3><ul><li>管理一组GameServer</li><li>支持滚动更新发布</li><li>支持分批（灰度）发布</li><li>支持原地更新发布</li><li>支持资源自动弹性伸缩</li></ul><h2 id=squad更新策略>Squad更新策略</h2><p>Squad通过<code>.spec.strategy</code>来指定更新GameServer的策略。<code>.spec.strategy.type</code>可以是 <code>Recreate</code>、<code>RollingUpdate</code>、<code>CanaryUpdate</code>、或者<code>InplaceUpdate</code>，默认为<code>RollingUpdate</code></p><h3 id=recreate策略>Recreate策略</h3><p>在创建GameServer前，所有现有的GameServer会被删除掉</p><h3 id=rollingupdate策略>RollingUpdate策略</h3><p>在指定<code>.spec.strategy.type</code>为RollingUpdate时，还可以指定<code>maxUnavailable</code> 和 <code>maxSurge</code> 来控制滚动更过程</p><ul><li><p>maxUnavailable：最大不可用GameServer数。是一个可选字段，用来指定更新过程中不可用的 GameServer 的个数上限。该值可以是绝对数字（例如，5），也可以是所需 GameServer 的百分比（例如，10%）。百分比值会转换成绝对数并去除小数部分。 如果 <code>.spec.strategy.rollingUpdate.maxSurge</code> 为 0，则此值不能为 0。 默认值为 25%</p></li><li><p>maxSurge: 最大GameServer创建数。是一个可选字段，用来指定可以创建的超出期望 GameServer 个数的 GameServer 数量。此值可以是绝对数（例如，5）或所需 GameServer 的百分比（例如，10%）。 如果 MaxUnavailable 为 0，则此值不能为 0。百分比值会通过向上取整转换为绝对数。 此字段的默认值为 25%。</p><blockquote><p>例如：当此值为25%时，启动滚动更新后，会立即对新的 GameServerSet 扩容，同时保证新旧 GameServer 的总数不超过所需 GameServer 总数的 125%。一旦旧 GameServer 被杀死，新的 GameServerSet 可以进一步扩容， 同时确保更新期间的任何时候运行中的 GameServer 总数最多为所需 GameServer 总数的 125%</p></blockquote></li></ul><p>使用示例：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>carrier.ocgi.dev/v1alpha1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Squad</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>squad5</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
  <span style=color:#f92672>scheduling</span>: <span style=color:#ae81ff>MostAllocated</span>
  <span style=color:#f92672>selector</span>:
    <span style=color:#f92672>matchLabels</span>:
      <span style=color:#f92672>carrier.ocgi.dev/squad</span>: <span style=color:#ae81ff>squad5</span>
  <span style=color:#f92672>strategy</span>:
    <span style=color:#f92672>rollingUpdate</span>:
      <span style=color:#f92672>maxSurge</span>: <span style=color:#ae81ff>25</span><span style=color:#ae81ff>%</span>
      <span style=color:#f92672>maxUnavailable</span>: <span style=color:#ae81ff>25</span><span style=color:#ae81ff>%</span>
    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>RollingUpdate</span>
...
</code></pre></div><h3 id=canaryupdate策略>CanaryUpdate策略</h3><p>分批灰度更新策略，在CanaryUpdate策略下，还可以指定<code>type</code>和<code>threshold</code>来控制灰度过程</p><ul><li>type: 灰度过程中GameServer的更新规则，包括“deleteFirst”、“createFirst”或者“inplace”<ul><li>deleteFirst：在创建新的GameServer时，先删除旧的GameServer</li><li>createFirst: 先创建新的GameServer，并且在新的GameServer Ready后，才会删除旧的GameServer</li></ul></li><li>threshold: 灰度的阀值，用于控制每批灰度的GameServer数，这里可以是绝对数字（例如，5），也可以是所有 GameServer 的百分比（例如，10%）</li></ul><p>使用示例：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>carrier.ocgi.dev/v1alpha1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Squad</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>squad5</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
  <span style=color:#f92672>scheduling</span>: <span style=color:#ae81ff>MostAllocated</span>
  <span style=color:#f92672>selector</span>:
    <span style=color:#f92672>matchLabels</span>:
      <span style=color:#f92672>carrier.ocgi.dev/squad</span>: <span style=color:#ae81ff>squad5</span>
  <span style=color:#f92672>strategy</span>:
    <span style=color:#f92672>canaryUpdate</span>:
      <span style=color:#f92672>tpye</span>: <span style=color:#ae81ff>createFirst</span>
      <span style=color:#f92672>threshold</span>: <span style=color:#ae81ff>10</span><span style=color:#ae81ff>%</span>
    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>CanaryUpdate</span>
...
</code></pre></div><h3 id=inplaceupdate策略>InplaceUpdate策略</h3><p>原地更新策略，以Update GameServer的方式来更新容器，而非重建整个GameServer，可以保持GameServer的IP不变，同时GameServer的挂载的内容（例如共享内存）得以保持下来。更新过程中通过<code>threshold</code>来控制更新的副本数</p><ul><li><p>threshold: 灰度的阀值，用于控制每批灰度的GameServer数，这里可以是绝对数字（例如，5），也可以是所有 GameServer 的百分比（例如，10%）</p><blockquote><p>更新时需要手动调整threshold值， 当所有的副本数都更新完之后，threshold会被重置成0,以防止下层更新时误操作 。</p></blockquote></li></ul><p>使用示例：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>carrier.ocgi.dev/v1alpha1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Squad</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>squad5</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
  <span style=color:#f92672>scheduling</span>: <span style=color:#ae81ff>MostAllocated</span>
  <span style=color:#f92672>selector</span>:
    <span style=color:#f92672>matchLabels</span>:
      <span style=color:#f92672>carrier.ocgi.dev/squad</span>: <span style=color:#ae81ff>squad5</span>
  <span style=color:#f92672>strategy</span>:
    <span style=color:#f92672>inplaceUpdate</span>:
      <span style=color:#f92672>threshold</span>: <span style=color:#ae81ff>1</span>
    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>InplaceUpdate</span>
...
</code></pre></div></div><p class="post-meta border-bottom pb-3 mb-0 mt-3">Updated on 2020-11-24</p></p><nav class="pagination mt-3"><a class="nav nav-prev" href=https://ocgi.github.io/zh/docs/guides/><i class="ti-arrow-left mr-2"></i> <span class="d-none d-md-block">Guides</span></a>
<a class="nav nav-next" href=https://ocgi.github.io/zh/docs/guides/gpa/><span class="d-none d-md-block">GeneralPodAutoscaler介绍</span><i class="ti-arrow-right ml-2"></i></a></nav></div></div></div></div></section><footer class="section pb-4"><div class=container><div class="row align-items-center"><div class="col-md-8 text-md-left text-center"><p class="mb-md-0 mb-4">Copyright © 2021 The OCGI Authors</p></div><div class="col-md-4 text-md-right text-center"><ul class=list-inline></ul></div></div></div></footer><script src=https://ocgi.github.io/js/script.min.js></script></body></html>